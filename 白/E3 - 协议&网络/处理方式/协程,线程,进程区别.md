# 区别

## 概念

1. 进程

    1. 进程是具有一定独立功能的程序关于某个数据集合上的一次运行活动
    2. 进程是系统进行资源分配和调度的一个独立单位

    3. 每个进程都有自己的独立内存空间，不同进程通过进程间通信来通信。
    4. 由于进程比较重量，占据独立的内存，所以上下文进程间的切换开销（`栈、寄存器、虚拟内存、文件句柄`等）比较大，但相对比较稳定安全。

2. 线程

    1. 线程是进程的一个实体,是CPU调度和分派的基本单位
    2. 它是比进程更小的能独立运行的基本单位.
    3. 线程自己基本上不拥有系统资源,只拥有一点在运行中必不可少的资源(如`程序计数器,一组寄存器和栈`)
    4. 但是它可与同属一个进程的其他的线程共享进程所拥有的全部资源。
    5. 线程间通信主要通过`共享内存`，上下文切换很快，资源开销较少，但相比进程不够稳定容易丢失数据。

3. 协程

    1. 协程是一种用户态的轻量级线程，协程的调度完全由用户控制。
    2. 协程拥有**自己的寄存器上下文和栈**。
    3. 协程调度切换时，将寄存器上下文和栈保存到其他地方
    4. 在切回来的时候，恢复先前保存的寄存器上下文和栈
    5. 直接操作栈则基本没有内核切换的开销，可以不加锁的访问全局变量，所以上下文的切换非常快。

## 区别：

### 进程多与线程比较

    线程是指进程内的一个执行单元,也是进程内的可调度实体。

- 线程与进程的区别:

1. 地址空间:线程是进程内的一个执行单元，进程内至少有一个线程，它们共享进程的地址空间，而进程有自己独立的地址空间
2. 资源拥有:进程是资源分配和拥有的单位,同一个进程内的线程共享进程的资源
3. 线程是处理器调度的基本单位,但进程不是
4. 二者均可并发执行

5. 每个独立的线程有一个程序运行的入口、顺序执行序列和程序的出口，但是线程不能够独立执行，必须依存在应用程序中，由应用程序提供多个线程执行控制

### 协程多与线程进行比较

1. 一个线程可以多个协程，一个进程也可以单独拥有多个协程，这样则能使协程使用多核CPU。

2. 线程进程都是同步机制，而协程则是异步

3. 协程能保留上一次调用时的状态，每次过程重入时，就相当于进入上一次调用的状态

## 总结

为了高性能 ，选择线程是没错的，但是需要良好的结构和设计调度，减少大量无用的锁、切换、等待操作,使得CPU空闲和无用操作时间减少，线程能利用多核达到**真正的并行计算**

而协程在同一时间只有一个协程拥有运行权，多个协程交换占用，但是因为使用简单，感觉起来符合顺序执行，不需要良好的设计也不会影响太多CPU性能，所以推荐单一无复杂需求程序或者模块使用(**本身就是一个线程更加细分**)

> 协程就是一串比函数粒度还要小的可手动控制的过程，方便随时切换，也不容易阻塞，但阻塞就完蛋了了
> 多个协程协作好比就是你一个人其实同时只能做一件事，但是你把几个任务拆成几截来交叉执行。