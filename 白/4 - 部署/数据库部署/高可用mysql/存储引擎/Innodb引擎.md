# Innodb引擎

> 5.5版本以后默认引擎,支持事务操作

## 特性  

### 数据存储方式

> 使用表空间进行数据存储

    innodb_file_per_table

    ON : 独立表空间(默认)  `数据库名(文件夹)/tablename.idb`
    OFF : 与系统存在同一个的表空间下 ibdataX(X:为序号)

> 5.0 之前是默认 OFF

+ 使用系统表空间 缺点

1. 系统表空间无法简单的收缩文件大小
2. 独立表空间可以通过 `optimize table` 命令收缩表
    > 本质还是**清理**之后进行**重建**
   > 且不会影响该表正常访问,不需要重新启动数据库

3. 系统表空间会存在IO瓶颈
4. 独立表空间可以同时向多个文件刷新数据

+ 将系统表空间转到独立表空间

1. 使用 mysqldump 导出所有数据
2. 停止MySQL服务器,修改`my.cnf`参数,并删除原`innodb`系统表空间中相关文件
3. 重启MySQL服务,重建 系统表
4. 导入数据

> 如果用`update`操作,磁盘中的系统表空间并不会减小,所以**重建系统表**是最好的办法

+ `innodb`默认存放在系统表空间的字段

> `innodb` 数据字典信息 (`B`树)
> `UNdo回滚段`

### 事务

+ 日志 

`Redo Log` 和 `Undo Log`
> 日志文件为二进制文件

> log 缓存大小 `innodb_log_files_buffer_size` (默认每一秒进行缓存区写入到磁盘)

默认 磁盘文件 `ib_logfileX`(X:为数字序号)

进行事务回滚或者其他事务操作时,可能需要存缓存或者磁盘中读取对应日志

通过 
>> 1. 扩大 log缓存大小
>> 2. 更换 ssd磁盘
>> 等操作可以提高事务操作的速度

### 锁

+ 行级锁

写操作 使用资源最少

1. 行级锁可以最大程度支持并发
2. 行级锁是由存储引擎层实现的

事务中在开始事务时,操作的写锁被阻塞,其他查询此时读取的是**日志中老数据**

+ 粒度

> 细致程度

支持 `表级锁,行级锁`

1. 表级锁
    > 用在更新数据量较大时可使用,减少系统资源损耗

    `lock table tablename read/write`

    > 独占锁 ,此时其他线程查询被阻塞

    `unlock tables` 解锁操作

2. 行级锁

    > 多数据时,比表级锁开销要大

## 状态检查

> `show engine innodb status`

> 具体信息参照 

`https://dev.mysql.com/doc/refman/5.5/en/show-engine.html`


## 使用场景

> 默认无特殊指定选择 Innodb

> 也支持 去**全文索引** ,**空间函数**