# 部署

## VPS推荐

1. vultr是折算成小时计费，且可以随时删除和开通服务器，新服务器就是新的ip。
2. 新开服务器只需要0.01美元，即使你运气非常不好，开了10台服务器才获得没有被墙的ip，总创建服务器成本也只有0.1美元，不到1块钱。
3. 开通服务器时，当出现了ip，不要立马去ping或者用xshell去连接，再等5分钟之后，有个缓冲时间。

vultr实际上是折算成小时来计费的，比如服务器是5美元1个月，那么每小时收费为5/30/24=0.0069美元 会自动从账号中扣费，只要保证账号有钱即可。如果你部署的服务器实测后速度不理想，你可以把它删掉（destroy），重新换个地区的服务器来部署，方便且实用。因为新的服务器就是新的ip，所以当ip被墙时这个方法很有用。当ip被墙时，为了保证新开的服务器ip和原先的ip不一样，先开新服务器，开好后再删除旧服务器即可。

计费从你开通服务器开始算的，不管你有没有使用，即使服务器处于关机状态仍然会计费，如果你没有开通服务器就不算。比如你今天早上开通了服务器，但你有事情，晚上才部署，那么这段时间是会计费的。同理，如果你早上删掉服务器，第二天才开通新的服务器，那么这段时间是不会计费的。在账号的Billing选项里可以看到账户余额。

温馨提醒：同样的服务器位置，不同的宽带类型和地区所搭建的账号的翻墙速度会不同，这与中国电信、中国联通、中国移动国际出口带宽和线路不同有关，所以以实测为准。可以先选定一个服务器位置来按照教程进行搭建，熟悉搭建方法，当账号搭建完成并进行了bbr加速后，测试下速度自己是否满意，如果满意那就用这个服务器位置的服务器。如果速度不太满意，就一次性开几台不同的服务器位置的服务器，然后按照同样的方法来进行搭建并测试，选择最优的，之后把其它的服务器删掉，按小时计费测试成本可以忽略。

## v2ray简介

### v2ray的优势：

1. v2ray支持的传输方式有很多，包括：普通TCP、HTTP伪装、WebSocket流量、普通mKCP、mKCP伪装FaceTime通话、mKCP伪装BT下载流量、mKCP伪装微信视频流量
2. 不同的传输方式其效果会不同，有可能会遇到意想不到的效果哦！
3. 当然国内不同的地区、不同的网络环境，效果也会不同，所以具体可以自己进行测试。
4. 现在v2ray客户端也很多了，有windows、MAC、linux和安卓版。

## 注意：

1. 搭建ss/ssr脚本和搭建v2ray脚本不要在同一台vps上使用，以免互相干扰！
2. 如果ss/ssr和v2ray都想搭建，可以用两台vps，一台搭建ss/ssr，另外一台搭建v2ray。

-------------

## 服务器选择

1. 配合v2ray一键搭建脚本，vps操作系统推荐选择Debian 8
2. 其它支持系统有Debian 7、Ubuntu 14、Ubuntu 16、CentOS 7。（注意：不支持centos 6系统！centos 6是ss/ssr搭建教程的推荐系统，但centos 6不支持v2ray一键搭建脚本！）
3. 开通服务器时，当出现了ip，不要立马去ping或者用xshell去连接，再等5分钟之后，有个缓冲时间。
4. 完成购买后，找到系统的密码记下来，部署服务器时需要用到。

- 一个被墙ip的vps被删掉后，其ip并不会消失，会随机分配给下一个在这个服务器位置新建服务器的人，这就是为什么开新服务器会有一定几率开到被墙的ip。
- 被墙是指在国内地区无法ping通服务器，但在国外是可以ping通的，vultr是面向全球服务，如果这个被墙ip被国外的人开到了，它是可以被正常使用的，半年或1年后这个被墙的ip可能会被国内防火墙解封，那么这就是一个良性循环。

## 部署VPS服务器

`Debian8（推荐）/Debian7/Ubuntu16/Ubuntu14/centos7`

### v2ray一键部署管理脚本：

安装脚本命令：

`wget -N --no-check-certificate https://raw.githubusercontent.com/KiriKira/v2ray.fun/kiriMod/install.sh && bash install.sh`

卸载脚本命令：

`wget -N --no-check-certificate https://raw.githubusercontent.com/KiriKira/v2ray.fun/kiriMod/uninstall.sh && bash uninstall.sh`


## 开始服务

v2ray服务端配置

管理命令为：`v2ray`

### 输入数字2进行更改配置，共有6个子选项，包括：

1. 更改UUID
2. 更改主端口
3. 更改加密方式
4. 更改传输方式
5. 更改TLS设置（有域名才行）
6. 更改广告拦截功能。（更改TLS设置和更改广告拦截功能不用设置）

- 输入数字1来更改新的UUID号，弹出提示后，输入字母y来确认。

- 修改`UUID`号，界面会回到v2ray主界面，重新输入2进入更改配置选项，在输入数字`2`来更改主端口，主端口范围`40～65535`，理论上可以任意设置，但不要以`0`开头！

- 重新进入更改配置选项，输入数字`3`来更改加密方式，加密方式有4种，最后1种为不加密。

- 接着，进行传输方式的设置，传输方式共有7种，这个配置对`v2ray`的速度起着很大的作用，具体哪个最适合看那里的网络环境，需要自己来尝试。

### 注意：

1. 普通TCP、普通mKCP、mKCP伪装FaceTime通话、mKCP伪装BT下载流量、mKCP伪装微信视频流量可直接设置、不需要域名
2. HTTP伪装和WebSocket流量需要你有域名，且域名绑定了你的`vps`服务器`ip`。

- 进行了更改配置的设置后，输入数字3可以查看自己设置的v2ray信息。

- 最后一步很关键，那就是启动服务，进入主界面后，输入数字`1`，然后输入`1`启动v2ray服务。

> 以后，每次更改配置或重启vps服务器后都要进行启动服务，请牢记！

- 将配置文件导出，方便配置v2ray客户端。

vps服务器里面的`config.json`配置文件存放路径为 `/etc/v2ray/config.json`

----

## 客户端配置

下面这个`config.json`文件就是刚刚在服务器上配置的v2ray文件

> 如果以后更改了v2ray服务端信息，那么需要重新导出config.jason文件。

因为一键搭建`v2ray`脚本是一个循环脚本，当配置结束后不会自动退出快捷管理命令，需要的话`ctrl+z`

----

## 一键加速VPS服务器

【谷歌BBR加速教程】

`wget --no-check-certificate https://github.com/teddysun/across/raw/master/bbr.sh`

`chmod +x bbr.sh`

`./bbr.sh`

最后输入`reboot`来重启服务器，确保加速生效，`bbr`加速脚本是开机自动启动，装一次就可以了。

服务器重启成功并重新连接服务器后，输入命令`lsmod | grep bbr` 如果出现`tcp_bbr`字样表示bbr已安装并启动成功。

### 注意：

根据反馈，少部分人安装bbr脚本并重启后，几分钟过去了，发现xshell无法连接服务器且服务器ip无法ping通。

> 解决方法是：开新服务器或者重装系统，然后**先安装bbr脚本再安装v2ray脚本**。

需要注意的是：不管是重启服务器，还是以后想修改之前vps里面的v2ray配置信息，当你重启好服务器或者修改好了v2ray配置信息后，都需要启动v2ray服务端。

------

下载windows版客户端后解压出来，然后替换config.json配置文件。

运行上图中的v2ray.exe启动软件，浏览器代理设置成Socks(5) `127.0.0.1 和1080` 即可通过v2ray代理上网。
