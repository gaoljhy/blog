# 原理

## 像图片的木马桌面程序

图片木马各类繁多（`jpeg、bmp`等）

伪装成“图片”的木马，无论其外表多么具有迷惑性，但木马的本质是改变不了的。
木马必然是个可执行的程序文件，其后缀名是`exe`，这是不可更改的

## Web 服务端图片木马

使用`copy`连接 `jpg`与服务器程序

## 利用了Windows的漏洞

自动运行，不需要点击。
这种病毒主要是利用了`Windows`的漏洞，把木马加载在图片中，只要没有打上相应补丁的电脑游览到这些图片的时候就会自动下载该图片信息中所包含的木马信息，进而达到木马种植功能

这些漏洞不止Windows有，是很多软件都有，甚至`sns wechat`工具，所以需要把那些常会看到图片的软件的相关漏洞都打上补丁。

## 利于图片meta数据区

### Ps插入

1.用PS（photoshop）打开图片

2.文件→文件简介
插入你需要的木马代码

3.文件→保存（保存：覆盖源文件 也可以另存为想要的其它格式）

> 然后使用解析器执行

## Flash动画

无需利用系统漏洞，而是利用动画本身的特性，直接对用户进行攻击。

Flash动画攻击原理:

是在网页中显示或本地直接播放Flash动画木马时，让`Flash`自动打开一个网址，而该网页就是攻击者预先制作好一个木马网页。Flash动画木马，其实就是利用Flash跳转特性，进行网页木马攻击的。

## `WMF文件远程溢出漏洞`制作的，

远程溢出与图片相结合制作出的新型`WMF`图片木马，危害极为巨大。
当用户访问包含这类图片的网页时，将打开一个空白页面，但是如果机器存在MS0601漏洞，就会自动下载运行木马。

## MIME头漏洞

MIME木马是把一个`EXE`文件用`MIME`编码为一个`EML`(OUT LOOK信件)文件,放到网页上利用IE和OE的编码漏洞实现自动下载和执行.

## BMP木马

它把一个`EXE`文件伪装成一个`BMP`图片文件,欺骗`IE`自动下载,再利用网页中的脚本查找客户端的`Internet`临时文件夹,找到下载后的BMP文件,把它拷贝到`TEMP`目录.

再编写一个脚本把找到的`BMP`文件用`DEBUG`还原成`EXE`,并把它放到注册表启动项中,在下一次开机时执行.

脚本会找出在临时文件夹中的`bmp`文件,并生成一个`DEBUG`的脚本,运行时会自动从BMP文件54字节处读去你指定大小的数据,并把它保存到`tmp.dat`中.后面的脚本再把它复制到`SYSTEM`的目录下.

这个被还原的EXE文件会在下次重起的时候运行.这就是BMP木马的基本实现过程.

## 文件类型伪装

自己去查查BMP文件资料就会知道,BMP文件的文件头有54个字节,简单来说里面包含了BMP文件的长宽,位数,文件大小,数据区长度,只要在`EXE`文件的文件头前面添加相应的`BMP`文件头即可
> 当然BMP文件头里面的数据要符合EXE文件的大小